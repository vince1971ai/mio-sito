<!DOCTYPE html>
<html lang="en"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contact - Nik Tesla AI</title> <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.2/p5.js"></script>
    <script src="sketch.js"></script>
    </head>
<body>
    <div class="button-container">
        <a href="index.html" class="nav-button">HOME</a>
        <a href="about.html" class="nav-button">ABOUT</a>
        <a href="future.html" class="nav-button">FUTURE</a>
        <a href="podcast.html" class="nav-button">PODCAST</a> <a href="badge.html" class="nav-button">BADGE</a>
        <a href="contact.html" class="nav-button">CONTACT</a>
    </div>

    <div class="form-container">
        <h1>Contact Us</h1> <form id="contactForm" class="contact-form">

            <div>
                <label for="name" class="required">Name:</label> <input type="text" id="name" name="name" required>
            </div>

            <div>
                <label for="email" class="required">Email:</label> <input type="email" id="email" name="email" required>
            </div>

            <div>
                <label for="message">Message:</label> <textarea id="message" name="message" maxlength="200"></textarea>
            </div>

            <div>
                 <label for="website">Website:</label> <input type="url" id="website" name="website">
            </div>

            <div>
                <button type="submit">Send Message</button> </div>

            <div id="formStatusMessage" style="margin-top: 15px; text-align: center; font-weight: bold;"></div>

        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const contactForm = document.getElementById('contactForm');
            const formStatusMessage = document.getElementById('formStatusMessage');

            // *** URL DELLA TUA FUNZIONE SERVERLESS PYTHON SU VERCEL PER L'INVIO EMAIL ***
            // Usiamo window.location.origin per ottenere la parte base dell'URL
            // della pagina corrente (es. https://[deployment-id].vercel.app o https://tuo-domino.com)
            // e aggiungiamo il percorso alla tua API di invio email.
            const API_ENDPOINT_PATH = '/api/send-email'; // <--- Assicurati che questo percorso sia corretto (nome della cartella + index.py)
            const SEND_EMAIL_API_URL = window.location.origin + API_ENDPOINT_PATH;

            console.log("Send Email API URL being called:", SEND_EMAIL_API_URL); // Log per debug

            // Controlla che gli elementi HTML necessari esistano
            if (!contactForm || !formStatusMessage) {
                console.error("Elementi HTML per il form di contatto non trovati. La funzionalità di invio email non sarà attiva.");
                return; // Esci dalla funzione se non trovi gli elementi
            }


            // Aggiungi un ascoltatore per l'evento 'submit' del form
            contactForm.addEventListener('submit', async (event) => {
                event.preventDefault(); // Impedisce l'invio standard del form (ricaricamento pagina)

                // Resetta il messaggio di stato
                formStatusMessage.textContent = '';
                formStatusMessage.style.color = 'white'; // Colore di default

                // Raccogli i dati del form
                const formData = new FormData(contactForm);
                const jsonData = {};
                formData.forEach((value, key) => {
                    jsonData[key] = value;
                });

                // Mostra un messaggio di caricamento e disabilita il bottone
                const submitButton = contactForm.querySelector('button[type="submit"]');
                submitButton.textContent = 'Sending...'; // Testo bottone in inglese
                submitButton.disabled = true;

                try {
                    // Fai la chiamata HTTP (fetch) alla tua funzione serverless
                    const response = await fetch(SEND_EMAIL_API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(jsonData) // Invia i dati del form come JSON
                    });

                    const result = await response.json(); // Assumi che la tua API risponda con JSON

                    if (response.ok) { // Controlla se la risposta HTTP è OK (200-299)
                        if (result.success) {
                            formStatusMessage.textContent = result.message || 'Message sent successfully!'; // Messaggio di successo in inglese
                            formStatusMessage.style.color = 'lightgreen';
                            contactForm.reset(); // Svuota il form se l'invio è riuscito
                        } else {
                            // Se la risposta HTTP è OK ma il backend segnala un errore logico
                            formStatusMessage.textContent = result.message || 'Error sending message.'; // Messaggio di errore in inglese
                            formStatusMessage.style.color = 'salmon';
                             console.error('Backend reported failure:', result.message);
                        }
                    } else {
                        // Se c'è stato un errore HTTP (es. 400, 500)
                        const errorBody = result.message || await response.text(); // Prova a leggere il messaggio di errore dal JSON o dal testo
                        throw new Error(`Backend HTTP error: ${response.status} ${response.statusText} - ${errorBody}`);
                    }

                } catch (error) {
                    console.error('Error submitting form:', error);
                    formStatusMessage.textContent = `Error: ${error.message || 'Could not send message.'}`; // Messaggio di errore in inglese
                    formStatusMessage.style.color = 'red';
                } finally {
                    submitButton.textContent = 'Send Message'; // Ripristina il testo del bottone in inglese
                    submitButton.disabled = false; // Riabilita il bottone
                }
            });
        });
    </script>

</body>
</html>
